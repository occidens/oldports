# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup           github 1.0

github.setup        technomancy leiningen 2.6.1
categories          devel java
maintainers         nomaintainer
platforms           darwin
supported_archs     noarch
license             EPL-1

description         A build tool for Clojure designed to not set your hair on fire.
long_description    ${description}

checksums           rmd160  232ed012595ac8e5d8ad75a7e20cdfe2f554a5de \
                    sha256  7e1b49d21c7cdfb4b897493914a5965ad6d8c0217fcc54b3de42cc963c723e2e

depends_build       port:clojure \
                    port:clojure-contrib \
                    port:apache-ant \
                    port:maven2 \
                    port:maven-ant-tasks
depends_run         port:jline

post-patch {
    copy ${filespath}/build.xml ${worksrcpath}
    reinplace "s|__PREFIX__|${prefix}/share/java|" ${worksrcpath}/build.xml
}

use_configure       no

build.cmd           ant
build.target        jar

destroot {
    set javadir ${prefix}/share/java
    reinplace "s|__PREFIX__|${javadir}|" ${worksrcpath}/bin/lein
    xinstall -m 0755 -d ${destroot}${javadir}
    xinstall -m 0755 ${worksrcpath}/bin/lein ${destroot}${prefix}/bin
    xinstall -m 0644 ${worksrcpath}/leiningen.jar ${destroot}${javadir}

    if {[variant_isset bash_completion]} {
        set completions_path ${prefix}/share/bash-completion/completions
        xinstall -d ${destroot}${completions_path}
        xinstall -m 644 ${worksrcpath}/bash_completion.bash ${destroot}${completions_path}/leiningen
        ln -s ${completions_path}/leiningen ${destroot}${completions_path}/lein
    }

    if {[variant_isset zsh_completion]} {
        set site_functions_path ${destroot}${prefix}/share/zsh/site-functions
        xinstall -d ${site_functions_path}
        xinstall -m 644 ${worksrcpath}/zsh_completion.zsh ${site_functions_path}/_lein
    }
}

variant bash_completion description {Add Bash completion} {
    depends_run-append path:etc/bash_completion:bash-completion
}
variant zsh_completion description {Add Zsh completion} {
    depends_run-append path:${prefix}/bin/zsh:zsh
}
